@model PBL3.ViewModels.Moderator.ViewUserViewModel
@{
    ViewData["Title"] = "Thông tin người dùng";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}
<link rel="stylesheet" href="~/css/ViewUser.css" />
<div class="view-user-container">
    <!-- Section 1: User Profile -->
    <section class="user-profile-section card mb-4">
        <div class="card-header"><h4>Thông tin người dùng</h4></div>
        <div class="card-body d-flex align-items-center">
            <img src="@Model.userProfile.Avatar" class="user-avatar me-4" alt="Avatar" />
            <div>
                <h5>@Model.userProfile.DisplayName</h5>
                <p>Email: @Model.userProfile.Email</p>
                <p>Vai trò: @Model.userProfile.Role</p>
                <p>Ngày tạo: @Model.userProfile.CreatedAt.ToString("dd/MM/yyyy")</p>
                <p>Trạng thái: <span class="badge bg-info">@Model.userProfile.Status</span></p>
            </div>
        </div>
    </section>
    <!-- Section 2: User Stories -->
    <section class="user-stories-section card mb-4">
        <div class="card-header"><h4>Truyện đã đăng</h4></div>
        <div class="card-body">
            @if (Model.userStories.Any())
            {
                <div class="row">
                    @foreach (var story in Model.userStories)
                    {
                        <div class="col-md-4 mb-3">
                            <div class="story-card card h-100">
                                <img src="@story.Cover" class="card-img-top story-cover" alt="Cover" />
                                <div class="card-body">
                                    <h5 class="card-title">@story.Title</h5>
                                    <p>Số chương: @story.TotalChapters</p>
                                    <p>Cập nhật: @story.LastUpdated?.ToString("dd/MM/yyyy")</p>
                                    <span class="badge bg-secondary">@story.Status</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-muted">Chưa có truyện nào.</p>
            }
        </div>
    </section>
    <!-- Section 3: User Comments -->
    <section class="user-comments-section card mb-4">
        <div class="card-header"><h4>Bình luận</h4></div>
        <div class="card-body">
            @if (Model.UserComments.Any())
            {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Nội dung</th>
                            <th>Truyện/Chương</th>
                            <th>Ngày tạo</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var c in Model.UserComments)
                        {
                            <tr>
                                <td>@c.Content</td>
                                <td>@(c.StoryID != null ? $"Truyện #{c.StoryID}" : (c.ChapterID != null ? $"Chương #{c.ChapterID}" : ""))</td>
                                <td>@c.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@(c.IsDeleted ? "Đã xóa" : "Hoạt động")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">Chưa có bình luận nào.</p>
            }
        </div>
    </section>
    <!-- Section 4: Reports Created -->
    <section class="reports-created-section card mb-4">
        <div class="card-header"><h4>Report đã tạo</h4></div>
        <div class="card-body">
            @if (Model.ReportsCreated.Any())
            {
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Loại</th>
                            <th>Đối tượng</th>
                            <th>Lý do</th>
                            <th>Ngày tạo</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var r in Model.ReportsCreated)
                        {
                            <tr>
                                <td>@r.ReportType</td>
                                <td>@(r.StoryID != null ? $"Truyện #{r.StoryID}" : r.ChapterID != null ? $"Chương #{r.ChapterID}" : r.CommentID != null ? $"Bình luận #{r.CommentID}" : r.ReportedUserID != null ? $"User #{r.ReportedUserID}" : "Khác")</td>
                                <td>@r.Reason</td>
                                <td>@r.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@(r.Status ? "Đã xử lý" : "Chưa xử lý")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">Chưa có report nào.</p>
            }
        </div>
    </section>
    <!-- Section 5: Reports Received -->
    <section class="reports-received-section card mb-4">
        <div class="card-header"><h4>Report bị nhận</h4></div>
        <div class="card-body">
            @if (Model.ReportsReceived.Any())
            {
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Loại</th>
                            <th>Đối tượng</th>
                            <th>Lý do</th>
                            <th>Ngày tạo</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var r in Model.ReportsReceived)
                        {
                            <tr>
                                <td>@r.ReportType</td>
                                <td>@(r.StoryID != null ? $"Truyện #{r.StoryID}" : r.ChapterID != null ? $"Chương #{r.ChapterID}" : r.CommentID != null ? $"Bình luận #{r.CommentID}" : r.ReportedUserID != null ? $"User #{r.ReportedUserID}" : "Khác")</td>
                                <td>@r.Reason</td>
                                <td>@r.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@(r.Status ? "Đã xử lý" : "Chưa xử lý")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">Chưa có report nào.</p>
            }
        </div>
    </section>
</div>
<script src="~/js/ViewUser.js"></script>
