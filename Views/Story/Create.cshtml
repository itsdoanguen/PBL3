@using PBL3.ViewModels.Story
@model StoryCreateViewModel

@{
	ViewData["Title"] = "Tạo Truyện Mới";
	Layout = "~/Views/Shared/_StoryEditorLayout.cshtml";
}

@if (TempData["SuccessMessage"] != null)
{
	<div class="alert alert-success" role="alert">
		@TempData["SuccessMessage"]
	</div>
}

<div class="container py-5">
	<h2 class="mb-4 text-center">Tạo Truyện Mới</h2>
	<form asp-action="Create" method="post" enctype="multipart/form-data" class="row g-4">
		<!-- Cột bên trái: Ảnh bìa -->
		<div class="col-md-4 d-flex flex-column align-items-center">
			<label for="coverPreview" class="form-label">Ảnh Bìa</label>
			<div class="border rounded p-2 w-100 d-flex justify-content-center" style="height: 350px;">
				<img id="coverPreview" src="/image/default-cover.jpg" class="img-fluid rounded" style="max-height: 100%;">
			</div>
			<input type="file" id="coverInput" name="UploadCover" class="form-control mt-2" accept="image/*" onchange="previewImage(input)">
			<span asp-validation-for="UploadCover" class="text-danger"></span>
		</div>

		<!-- Cột bên phải: Form nhập thông tin -->
		<div class="col-md-8">
			<div class="mb-3">
				<label for="Title" class="form-label">Tiêu đề</label>
				<input asp-for="Title" class="form-control" required />
				<span asp-validation-for="Title" class="text-danger"></span>
			</div>

			<div class="mb-3">
				<label for="Description" class="form-label">Mô tả</label>
				<textarea asp-for="Description" class="form-control" rows="8" required></textarea>
				<span asp-validation-for="Description" class="text-danger"></span>
			</div>

			<!-- Thể loại -->
			<div class="mb-3 position-relative">
				<label class="form-label">Thể loại</label>
				<div id="genreTagList" class="genre-tag-list">
					@foreach (var genre in Model.availbleGenres.Where(g => g.IsSelected))
					{
						<span class="genre-tag" data-genre-id="@genre.GenreID">
							@genre.Name <button type="button" class="remove-genre" title="Xóa">&times;</button>
						</span>
					}
					<span class="ms-1"><button type="button" class="btn-add-genre" id="btnAddGenre" title="Thêm thể loại"><i class="bi bi-plus"></i></button></span>
				</div>
				<input type="hidden" name="GenreIDs" id="GenreIDsInput" value="@string.Join(",", Model.GenreIDs)" />
				<div id="genreDropdown" class="genre-dropdown">
					@foreach (var genre in Model.availbleGenres.Where(g => !g.IsSelected))
					{
						<div class="genre-dropdown-item" data-genre-id="@genre.GenreID">@genre.Name</div>
					}
				</div>
				<span asp-validation-for="GenreIDs" class="text-danger"></span>
			</div>


			<button type="submit" class="btn btn-success w-100">Tạo Truyện</button>
		</div>
	</form>
</div>

<link rel="stylesheet" href="~/css/story-create.css" asp-append-version="true" />
<script src="~/js/story-create.js" asp-append-version="true"></script>

<script>
	function previewImage(input) {
		var reader = new FileReader();
		reader.onload = function(){
			var output = document.getElementById('coverPreview');
			output.src = reader.result;
		};
		reader.readAsDataURL(input.target.files[0]);
	}
</script>
