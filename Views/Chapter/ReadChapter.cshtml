@model PBL3.ViewModels.Chapter.ChapterDetailViewModel
@{
    ViewData["Title"] = Model.Title;
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<style>
    .center-container {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
    }

    .chapter-content {
        text-align: left;
        white-space: pre-line;
    }

    .chapter-navigation {
        margin-top: 20px;
    }

    .comment {
        text-align: left;
        margin-bottom: 15px;
    }
</style>

<div class="center-container p-3">

    <!-- ✅ Sidebar toggle -->
    <button class="btn btn-info mb-3" onclick="toggleSidebar()">📚 Danh sách chương</button>

    <div id="chapterSidebar" class="p-3 border mb-3" style="display: none;">
        <h4>Danh sách chương</h4>
        <ul class="list-unstyled">
            @foreach (var chap in Model.ChapterList)
            {
                <li>
                    <a asp-controller="Chapter" asp-action="ReadChapter" asp-route-id="@chap.ChapterID">
                        @chap.Title
                    </a>
                </li>
            }
        </ul>
    </div>

    <h2>@Model.StoryTitle - Chương: @Model.Title</h2>
    <p><strong>Ngày đăng:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy") | <strong>Lượt xem:</strong> @Model.ViewCount</p>

    <!-- ✅ Form Like -->
    <form asp-action="LikeChapter" asp-controller="LikeChapter" method="post" class="my-3">
        @Html.AntiForgeryToken()
        <input type="hidden" name="chapterId" value="@Model.ChapterID" />
        <button type="submit" class="btn btn-sm @(Model.IsLikedByCurrentUser ? "btn-primary" : "btn-outline-primary") btn-modern">
            ❤️ @((Model.IsLikedByCurrentUser) ? "Đã thích" : "Like") (@Model.LikeCount)
        </button>
    </form>

    <hr />
    <div class="chapter-content">
        @Html.Raw(Model.Content)
    </div>

    <hr />
    <div class="chapter-navigation">
        @if (Model.PreviousChapterID != -1)
        {
            <a asp-controller="Chapter" asp-action="ReadChapter" asp-route-id="@Model.PreviousChapterID" class="btn btn-secondary">⬅ Chương trước</a>
        }
        else
        {
            <button class="btn btn-secondary disabled" disabled>⬅ Chương trước</button>
        }

        @if (Model.NextChapterID != -1)
        {
            <a asp-controller="Chapter" asp-action="ReadChapter" asp-route-id="@Model.NextChapterID" class="btn btn-secondary ml-2">Chương sau ➡</a>
        }
        else
        {
            <button class="btn btn-secondary disabled ml-2" disabled>Chương sau ➡</button>
        }
    </div>

    <hr />
    <h4>Bình luận (@Model.Comments.Count)</h4>
    @foreach (var comment in Model.Comments)
    {
        <div class="comment border p-2 rounded">
            <strong>@comment.UserID</strong> - <em>@comment.CreatedAt.ToString("g")</em>
            <p>@comment.Content</p>
        </div>
    }

    <form asp-action="PostComment" asp-controller="Comment" method="post" class="mt-3">
        @Html.AntiForgeryToken()
        <input type="hidden" name="ChapterID" value="@Model.ChapterID" />
        <textarea name="Content" rows="4" placeholder="Viết bình luận..." class="form-control"></textarea>
        <button type="submit" class="btn btn-primary mt-2">Gửi bình luận</button>
    </form>
</div>

@section Scripts {
    <script>
        function toggleSidebar() {
            var sidebar = document.getElementById('chapterSidebar');
            sidebar.style.display = (sidebar.style.display === "none") ? "block" : "none";
        }
    </script>
}
